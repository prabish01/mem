!function(e){e.fn.imageUploader=function(t){let n={preloaded:[],imagesInputName:"images",preloadedInputName:"preloaded",label:"Drag & Drop files here or click to browse"},a=this;a.settings={},a.init=function(){a.settings=e.extend(a.settings,n,t),a.each(function(t,n){let i=d();if(e(n).append(i),i.on("dragover",o.bind(i)),i.on("dragleave",o.bind(i)),i.on("drop",l.bind(i)),a.settings.preloaded.length){i.addClass("has-files");let e=i.find(".uploaded");for(let t=0;t<a.settings.preloaded.length;t++)e.append(r(a.settings.preloaded[t].src,a.settings.preloaded[t].id,!0))}})};let i=new DataTransfer,d=function(){let t=e("<div>",{class:"image-uploader"}),n=e("<input>",{type:"file",id:a.settings.imagesInputName+"-"+c(),name:a.settings.imagesInputName+"[]",multiple:""}).appendTo(t),i=(e("<div>",{class:"uploaded"}).appendTo(t),e("<div>",{class:"upload-text"}).appendTo(t));e("<i>",{class:"material-icons",text:"cloud_upload"}).appendTo(i),e("<span>",{text:a.settings.label}).appendTo(i);return t.on("click",function(e){s(e),n.trigger("click")}),n.on("click",function(e){e.stopPropagation()}),n.on("change",l.bind(t)),t},s=function(e){e.preventDefault(),e.stopPropagation()},o=function(t){s(t),"dragover"===t.type?e(this).addClass("drag-over"):e(this).removeClass("drag-over")},l=function(t){s(t);let n=e(this);n.removeClass("drag-over");let a=t.target.files||t.originalEvent.dataTransfer.files;p(n,a)},p=function(t,n){t.addClass("has-files");let a=t.find(".uploaded"),d=t.find('input[type="file"]');e(n).each(function(e,n){i.items.add(n),a.append(r(URL.createObjectURL(n),i.items.length-1,t))}),d.prop("files",i.files)},r=function(t,n,d){let o=e("<div>",{class:"uploaded-image"}),l=(e("<img>",{src:t}).appendTo(o),e("<button>",{class:"delete-image"}).appendTo(o));e("<i>",{class:"material-icons",text:"clear"}).appendTo(l);if(a.settings.preloaded.length){o.attr("data-preloaded",!0);e("<input>",{type:"hidden",name:a.settings.preloadedInputName+"[]",value:n}).appendTo(o)}else o.attr("data-index",n);return o.on("click",function(e){s(e)}),l.on("click",function(t){if(s(t),i.items.length>0){let t=parseInt(o.data("index"));o.find(".uploaded-image[data-index]").each(function(n,a){n>t&&e(a).attr("data-index",n-1)}),i.items.remove(t),$input=d.find('input[type="file"]'),$input.prop("files",i.files)}o.remove(),o.find(".uploaded-image").length||o.removeClass("has-files")}),o},c=function(){return Date.now()+Math.floor(100*Math.random()+1)};return this.init(),this}}(jQuery);